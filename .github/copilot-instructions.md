<!-- Autogenerated guidance for AI coding agents working on assistant-agent-mvp -->
# Copilot instructions — assistant-agent-mvp

Purpose
- Short: help an AI coding agent be immediately productive in this small FastAPI MVP.

Quick architecture (big picture)
- Lightweight FastAPI service that exposes a health endpoint and a single `/chat` route.
- Request/trace handling is performed by `app/logging_middleware.py` which injects `request.state.request_id` and `request.state.session_id` for downstream use.
- Schemas live in `app/schemas.py` (Pydantic v2 models). Business logic is currently minimal and `app/main.py` contains the request handling pipeline.

Key files to inspect
- app/main.py — entry routes and simple chat pipeline.
- app/schemas.py — `ChatRequest` and `ChatResponse` Pydantic models.
- app/logging_middleware.py — sets trace IDs, prints start/end logs, and returns `x-request-id`/`x-session-id` headers.

Runtime & developer commands
- Install dependencies: `pip install -r requirements.txt` (uses `python-dotenv`, FastAPI, uvicorn, Starlette, Pydantic v2).
- Run locally (development):
  - `uvicorn app.main:app --reload --port 8000`
  - The service reads environment via `.env` (uses `python-dotenv`).

Conventions & patterns specific to this repo
- Traceability: middleware generates `request_id` (UUID) and reads optional `x-session-id` header. Handlers read/override `request.state.session_id` and return the same IDs via response headers.
- Session ID precedence: `payload.session_id` (request body) → `x-session-id` header → generated UUID in handler. Preserve `request.state.session_id` for logs/headers.
- Minimal pipeline: handlers perform light normalization then build `ChatResponse` (see `app/main.py` for the echo pattern). Future LLM integrations should follow the same request/session handling and return `request_id` and `session_id`.
- Logging: the project uses plain `print()` for request start/end and errors. Keep logs compact and include `request_id` and `session_id`.
- Pydantic v2: models use `pydantic.BaseModel` and `Field`. When adding fields, prefer explicit `description` and `default_factory` for optional dicts.

Integration points & external deps
- `python-dotenv` for configuration.
- Uvicorn for ASGI server.
- Potential LLM/agent integrations should be added behind the `/chat` handler and must respect session/request-id wiring.

Examples (patterns to follow)
- Read trace IDs in middleware: `request.state.request_id` and `request.state.session_id` (see `app/logging_middleware.py`).
- Schema example: `ChatRequest` has `message`, optional `session_id`, and `metadata` (see `app/schemas.py`).

What an agent should do when editing code
- Preserve `request.state` behavior — tests and logs rely on `x-request-id` and `x-session-id` being present and consistent.
- Use existing dependency list in `requirements.txt` when adding libraries.
- Keep changes minimal and self-contained; add tests only when necessary and consistent with repo style (this repo currently has no test harness).

Where to look next
- Start from these files: `app/main.py`, `app/schemas.py`, `app/logging_middleware.py`, and `requirements.txt`.

If this file is out-of-date
- Merge cautiously: preserve middleware and schema conventions. Ask for clarification if a proposed change alters request/session wiring.

Feedback
- If anything here is unclear or you want additional examples (unit tests, debug tips, or a small local runbook), ask and I will expand.
